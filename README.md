# 🖼️ 무빙(BE)

<img width="1235" height="673" alt="image" src="https://github.com/user-attachments/assets/3f00fbc4-e7cc-40f9-a829-cbc228c7a2be" />

# 복잡한 이사, 무빙으로 끝!

### [🖼️ 무빙 구경하기 : https://www.moving-2.click](https://www.moving-2.click/)

### [📋 Team Notion 바로가기](https://www.notion.so/217fff3108c98098bd43fdc393e922a1?v=217fff3108c981078f8c000cd9c3e859_link)

### [🔗 6-moving-team2-FE 바로가기](https://github.com/sebiny/6-moving-team2-FE)

### [📚 Swagger API](https://api.moving-2.click/api-docs/)

<br>

## 목차

1. [프로젝트 소개](#1-프로젝트-소개)
2. [영상](#2-영상)
3. [시스템 아키텍처](#3-시스템-아키텍처)
4. [기술 스택](#4-기술-스택)
5. [팀 소개 및 문서](#5-팀-소개-및-문서)
6. [트러블 슈팅](#6-트러블-슈팅)
7. [폴더 구조](#7-폴더-구조)

## 1. 프로젝트 소개

- 무빙은 이사 전문가와 고객을 연결해주는 플랫폼
- 고객이 이사 정보를 요청하면, 여러 검증된 이사업체가 경쟁적으로 견적을 제시함
- 고객은 이사 업체들이 제안한 다양한 견적을 한눈에 비교하고, 가장 합리적인 가격과 조건을 선택할 수 있음
- 고객 리뷰를 통해 업체들의 자체적인 검증 가능
- 투명하고 공정한 이사 준비를 지원하며, 고객의 경제적 부담을 덜어 줄 수 있음

## 2. 영상

| 랜딩페이지                                                                                  | 실시간 알림 도착                                                                            | 견적 요청                                                                                   | 기사님 찾기                                                                                   |
| ------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------- |
| <img src="https://github.com/user-attachments/assets/a41cfa4d-33ca-4beb-b673-c4d2c8375db7" width="190"> | <img src="https://github.com/user-attachments/assets/370fa061-78f3-4d94-a416-5c941e27d650" width="190"> | <img src="https://github.com/user-attachments/assets/ebbaec8b-1810-4b86-9376-4e8ce9a43722" width="190"> | <img src="https://github.com/user-attachments/assets/bdd5e59c-0769-4bf7-a0db-db2cc6db0371" width="190" /> |

## 3. 시스템 아키텍처

## 4. 기술 스택

| Category    | Tech Stack                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| ----------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Backend** | ![NodeJS](https://img.shields.io/badge/node.js-6DA55F?style=for-the-badge&logo=node.js&logoColor=white) ![express](https://img.shields.io/badge/express-000000?style=for-the-badge&logo=express) ![Nodemon](https://img.shields.io/badge/NODEMON-76D04B.svg?style=for-the-badge&logo=nodemon&logoColor=FFFFFF) ![prisma](https://img.shields.io/badge/prisma-2D3748?style=for-the-badge&logo=prisma) ![Postgres](https://img.shields.io/badge/postgres-%23316192.svg?style=for-the-badge&logo=postgresql&logoColor=white)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| **Library** | ![passport](https://img.shields.io/badge/passport-000000?style=for-the-badge&logo=passport) ![superstruct](https://img.shields.io/badge/superstruct-CB3837?style=for-the-badge&logo=npm) ![bcrypt](https://img.shields.io/badge/bcrypt-CB3837?style=for-the-badge&logo=npm) ![express-jwt](https://img.shields.io/badge/express--jwt-DD0031?style=for-the-badge&logo=jsonwebtokens) ![jsonwebtoken](https://img.shields.io/badge/jsonwebtoken-DD0031?style=for-the-badge&logo=jsonwebtokens) ![multer](https://img.shields.io/badge/multer-CB3837?style=for-the-badge&logo=npm) ![Jest](https://img.shields.io/badge/-jest-%23C21325?style=for-the-badge&logo=jest&logoColor=white) ![Swagger](https://img.shields.io/badge/-Swagger-%23Clojure?style=for-the-badge&logo=swagger&logoColor=white) ![OAuth](https://img.shields.io/badge/OAuth-4285F4?style=for-the-badge&logo=oauth&logoColor=white) ![node-cron](https://img.shields.io/badge/node--cron-339933?style=for-the-badge&logo=node.js&logoColor=white) ![Sentry](https://img.shields.io/badge/Sentry-362D59?style=for-the-badge&logo=sentry&logoColor=white) ![DeepL](https://img.shields.io/badge/DeepL-0F2027?style=for-the-badge&logo=deepl&logoColor=white) |
| **Deploy**  | ![Amazon EC2](https://img.shields.io/badge/Amazon%20EC2-FF9900?style=for-the-badge&logo=amazon-ec2&logoColor=white) ![Amazon S3](https://img.shields.io/badge/Amazon%20S3-569A31?style=for-the-badge&logo=amazon-s3&logoColor=white) ![Amazon RDS](https://img.shields.io/badge/Amazon%20RDS-527FFF?style=for-the-badge&logo=amazon-rds&logoColor=white) ![Amazon CloudFront](https://img.shields.io/badge/Amazon%20CloudFront-FF9900?style=for-the-badge&logo=amazon-cloudfront&logoColor=white) ![Route 53](https://img.shields.io/badge/Route%2053-FF9900?style=for-the-badge&logo=amazon-route53&logoColor=white) ![Nginx](https://img.shields.io/badge/nginx-%23009639.svg?style=for-the-badge&logo=nginx&logoColor=white) ![Redis](https://img.shields.io/badge/redis-%23DD0031.svg?style=for-the-badge&logo=redis&logoColor=white) ![Application Load Balancer](https://img.shields.io/badge/AWS%20ALB-FF9900?style=for-the-badge&logo=amazon-aws&logoColor=white)                                                                                                                                                                                                                                                   |
| **Tool**    | ![Git](https://img.shields.io/badge/git-%23F05033.svg?style=for-the-badge&logo=git&logoColor=white) ![GitHub](https://img.shields.io/badge/github-%23121011.svg?style=for-the-badge&logo=github&logoColor=white) ![Notion](https://img.shields.io/badge/Notion-%23000000.svg?style=for-the-badge&logo=notion&logoColor=white) ![GitHub Actions](https://img.shields.io/badge/GitHub%20Actions-2088FF?style=for-the-badge&logo=githubactions&logoColor=white)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |

## 5. 팀 소개 및 문서


| 안세빈 | 최민경 | 김다은 | 김단이 | 오보람 | 이지수 | 황수정 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| [<img width="33" height="32" alt="깃허브" src="https://github.com/user-attachments/assets/fbad0d61-8481-424c-ac77-5f4466b7ef5a" />](https://github.com/sebiny) [<img width="28" height="30" alt="개발리포트" src="https://github.com/user-attachments/assets/508474a3-95ab-4239-bd0c-a1ca2d6d1199" />](https://www.notion.so/22afff3108c98004a243e75597d21347) | [<img width="33" height="32" alt="깃허브" src="https://github.com/user-attachments/assets/fbad0d61-8481-424c-ac77-5f4466b7ef5a" />](https://github.com/choi-mk) [<img width="28" height="30" alt="개발리포트" src="https://github.com/user-attachments/assets/508474a3-95ab-4239-bd0c-a1ca2d6d1199" />](https://www.notion.so/218950ee37c980758568e076529feb1c) | [<img width="33" height="32" alt="깃허브" src="https://github.com/user-attachments/assets/fbad0d61-8481-424c-ac77-5f4466b7ef5a" />](https://github.com/fs6-kde) [<img width="28" height="30" alt="개발리포트" src="https://github.com/user-attachments/assets/508474a3-95ab-4239-bd0c-a1ca2d6d1199" />](https://rain-quartz-d59.notion.site/21733256dfa4800a88b7c0699dd76be7) | [<img width="33" height="32" alt="깃허브" src="https://github.com/user-attachments/assets/fbad0d61-8481-424c-ac77-5f4466b7ef5a" />](https://github.com/danikim8) [<img width="28" height="30" alt="개발리포트" src="https://github.com/user-attachments/assets/508474a3-95ab-4239-bd0c-a1ca2d6d1199" />](https://danikim8.notion.site/part4-217826aac9d580268449cb2cab6e2a57) | [<img width="33" height="32" alt="깃허브" src="https://github.com/user-attachments/assets/fbad0d61-8481-424c-ac77-5f4466b7ef5a" />](https://github.com/elisaohh) [<img width="28" height="30" alt="개발리포트" src="https://github.com/user-attachments/assets/508474a3-95ab-4239-bd0c-a1ca2d6d1199" />](https://www.notion.so/218b7087731a805da4aaec67b7074aa5) | [<img width="33" height="32" alt="git" src="https://github.com/user-attachments/assets/fbad0d61-8481-424c-ac77-5f4466b7ef5a" />](https://github.com/afafmmm) [<img width="28" height="30" alt="개발리포트" src="https://github.com/user-attachments/assets/508474a3-95ab-4239-bd0c-a1ca2d6d1199" />]() | [<img width="33" height="32" alt="깃허브" src="https://github.com/user-attachments/assets/fbad0d61-8481-424c-ac77-5f4466b7ef5a" />](https://github.com/suejeong) [<img width="28" height="30" alt="개발리포트" src="https://github.com/user-attachments/assets/508474a3-95ab-4239-bd0c-a1ca2d6d1199" />](https://hungry-plate-76c.notion.site/Moving-217fff3108c980c8a0b1e8cb1c83d33f) |
| 팀장 | 부팀장 | 팀원 | 팀원 | 팀원 | 팀원 | 팀원 |
| 리뷰, 다국어 | 기사님 마이페이지,<br>기사님 찾기, AWS | 견적 (고객) | 견적 (기사), 스키마 | 견적 요청서 작성 (고객) | 인증 및 유저, AWS | 알림, 랜딩페이지 |


## 6. 트러블 슈팅

<details>
<summary><strong>[ 견적 완료 처리 스케줄러 ]</strong></summary>

### Problem

- 견적 요청(EstimateRequest)의 완료 처리를 위한 수동 업데이트 기능이 없었음
- 이사 날짜(moveDate)가 지난 견적들이 자동으로 COMPLETED 상태로 변경되지 않음
- 사용자가 수동으로 완료 처리할 수 있는 API 엔드포인트 부재

### Solution

- 이사 날짜가 지난 견적 요청을 자동으로 COMPLETED 상태로 업데이트하는 스케줄러 구현
- 배치 처리로 대량 데이터 처리 시 성능 최적화

</details>

<details>
<summary><strong>[ 기사님 평균 리뷰 계산 ]</strong></summary>

### Problem

- 기사님을 별점으로 정렬하기 기능 등 프론트에서 평균을 구했을 때 구현하기 어려운 기능들이 존재함
- 부동 소수점 연산 누적 오차로 인해 실제 평균과 차이가 발생할 수 있었음
- 리뷰 평균을 계산할 때 DB를 두 번 호출해야 하는 문제 발생

### Solution

- 계산 비용이 다소 있지만 정확도를 보장할 수 있어 리뷰를 저장할 때마다 전체 리뷰를 조회해 평균 값을 다시 계산함
- 리뷰 저장 후 해당 기사님의 모든 리뷰를 조회하여 평균 평점을 새로 계산하는 방식으로 수정하였고, 이를 통해 정확한 평점 반영이 가능해졌음
- 리뷰 생성 직후 `prisma.review.aggregate()`를 사용해 평균 평점을 한 번의 쿼리로 계산하여 평점을 갱신함

</details>

## 7. 폴더 구조

<details>
<summary>
🗄️ ERD (Entity Relationship Diagram)

</summary>
<div markdown="1">

<img width="100%" alt="ERD" src="erd.png" />

</div>
</details>

<details>
<summary>
Backend 폴더구조

</summary>
<div markdown="1">

```
📦 be/                           # 백엔드 프로젝트 루트
┣ 📂.github                      # GitHub 관련 설정
┃ ┗ 📂workflows                  # CI/CD 워크플로우 (GitHub Actions)
┃   ┗ 📜deploy.yml               # 배포 파이프라인 설정
┣ 📂node_modules                  # 설치된 라이브러리 (자동 생성)
┣ 📂prisma                       # 데이터베이스 관련
┃ ┣ 📂migrations                 # Prisma 마이그레이션 파일
┃ ┣ 📜schema.prisma              # Prisma 스키마 정의 파일
┃ ┣ 📜seed.ts                    # 초기 데이터 시드 스크립트
┃ ┣ 📜seed2.ts                   # 추가 시드 데이터
┃ ┣ 📜seed3.ts                   # 테스트용 시드 데이터
┃ ┗ 📜testSeed.ts                # 테스트 시드 데이터
┣ 📂src                          # 소스 코드
┃ ┣ 📂config                     # 환경 설정
┃ ┃ ├── 📜prisma.ts              # Prisma 클라이언트 설정
┃ ┃ └── 📜passport.ts            # Passport 인증 설정
┃ ┣ 📂controllers                # 요청-응답 처리 (Express 컨트롤러)
┃ ┃ ├── 📜auth.controller.ts     # 인증 관련 컨트롤러
┃ ┃ ├── 📜driver.controller.ts   # 기사 관련 컨트롤러
┃ ┃ ├── 📜estimateReq.controller.ts # 견적 요청 컨트롤러
┃ ┃ ├── 📜customerEstimate.controller.ts # 고객 견적 컨트롤러
┃ ┃ ├── 📜notification.controller.ts # 알림 컨트롤러
┃ ┃ ├── 📜profile.controller.ts  # 프로필 컨트롤러
┃ ┃ ├── 📜review.controller.ts   # 리뷰 컨트롤러
┃ ┃ ├── 📜favorite.controller.ts # 즐겨찾기 컨트롤러
┃ ┃ ├── 📜address.controller.ts  # 주소 컨트롤러
┃ ┃ ├── 📜shareEstimate.controller.ts # 견적 공유 컨트롤러
┃ ┃ └── 📜*.controller.test.ts   # 컨트롤러 테스트 파일들
┃ ┣ 📂services                   # 비즈니스 로직 계층
┃ ┃ ├── 📜auth.service.ts        # 인증 서비스
┃ ┃ ├── 📜driver.service.ts      # 기사 서비스
┃ ┃ ├── 📜estimateReq.service.ts # 견적 요청 서비스
┃ ┃ ├── 📜customerEstimate.service.ts # 고객 견적 서비스
┃ ┃ ├── 📜notification.service.ts # 알림 서비스
┃ ┃ ├── 📜profile.service.ts     # 프로필 서비스
┃ ┃ ├── 📜review.service.ts      # 리뷰 서비스
┃ ┃ ├── 📜favorite.service.ts    # 즐겨찾기 서비스
┃ ┃ ├── 📜address.service.ts     # 주소 서비스
┃ ┃ ├── 📜estimateCompletion.service.ts # 견적 완료 서비스
┃ ┃ └── 📜*.service.test.ts      # 서비스 테스트 파일들
┃ ┣ 📂repositories               # DB 접근 계층 (Prisma 쿼리 모음)
┃ ┃ ├── 📜auth.repository.ts     # 인증 리포지토리
┃ ┃ ├── 📜driver.repository.ts   # 기사 리포지토리
┃ ┃ ├── 📜estimateReq.repository.ts # 견적 요청 리포지토리
┃ ┃ ├── 📜customerEstimate.repository.ts # 고객 견적 리포지토리
┃ ┃ ├── 📜notification.repository.ts # 알림 리포지토리
┃ ┃ ├── 📜profile.repository.ts  # 프로필 리포지토리
┃ ┃ ├── 📜review.repository.ts   # 리뷰 리포지토리
┃ ┃ ├── 📜favorite.repository.ts # 즐겨찾기 리포지토리
┃ ┃ ├── 📜address.repository.ts  # 주소 리포지토리
┃ ┃ └── 📜*.repository.test.ts   # 리포지토리 테스트 파일들
┃ ┣ 📂routes                     # 라우터 정의
┃ ┃ ├── 📜auth.router.ts         # 인증 라우터
┃ ┃ ├── 📜driver.router.ts       # 기사 공개 라우터
┃ ┃ ├── 📜driverPrivate.router.ts # 기사 인증 라우터
┃ ┃ ├── 📜estimateReq.router.ts  # 견적 요청 라우터
┃ ┃ ├── 📜customerEstimate.router.ts # 고객 견적 라우터
┃ ┃ ├── 📜notification.router.ts # 알림 라우터
┃ ┃ ├── 📜profile.router.ts      # 프로필 라우터
┃ ┃ ├── 📜review.router.ts       # 리뷰 라우터
┃ ┃ ├── 📜favorite.router.ts     # 즐겨찾기 라우터
┃ ┃ ├── 📜address.router.ts      # 주소 라우터
┃ ┃ ├── 📜shareEstimate.router.ts # 견적 공유 라우터
┃ ┃ └── 📜translateRouter.ts     # 번역 라우터
┃ ┣ 📂middlewares                # Express 미들웨어
┃ ┃ ├── 📜errorHandler.ts        # 에러 핸들러
┃ ┃ ├── 📜authLimiter.ts         # 인증 제한
┃ ┃ ├── 📜cacheMiddleware.ts     # 캐시 미들웨어
┃ ┃ ├── 📜uploadMiddleware.ts    # 파일 업로드 미들웨어
┃ ┃ ├── 📜estimateCompletion.ts  # 견적 완료 미들웨어
┃ ┃ └── 📂passport               # Passport 전략
┃ ┃   ├── 📜jwtStrategy.ts       # JWT 전략
┃ ┃   └── 📜socialStrategy.ts    # 소셜 로그인 전략
┃ ┣ 📂utils                      # 유틸리티 함수 모음
┃ ┃ ├── 📜asyncHandler.ts        # 비동기 핸들러 래퍼
┃ ┃ ├── 📜customError.ts         # 커스텀 에러 클래스
┃ ┃ ├── 📜getCookieDomain.ts     # 쿠키 도메인 설정
┃ ┃ ├── 📜notificationMessage.ts # 알림 메시지 생성
┃ ┃ ├── 📜cronScheduler.ts       # 크론 스케줄러
┃ ┃ ├── 📜estimateCompletionScheduler.ts # 견적 완료 스케줄러
┃ ┃ ├── 📜moveReminder.ts        # 이사 알림
┃ ┃ └── 📜resetDB.ts             # DB 리셋 유틸리티
┃ ┣ 📂types                      # 타입 정의 (TS 인터페이스, 타입 등)
┃ ┃ ├── 📜index.d.ts             # 전역 타입 정의
┃ ┃ ├── 📜userType.ts            # 사용자 타입
┃ ┃ ├── 📜estimateReq.type.ts    # 견적 요청 타입
┃ ┃ ├── 📜notification.type.ts   # 알림 타입
┃ ┃ ├── 📜review.type.ts         # 리뷰 타입
┃ ┃ ├── 📜social.d.ts            # 소셜 로그인 타입
┃ ┃ └── 📜multer-s3.d.ts         # Multer S3 타입
┃ ┣ 📂sse                        # SSE(Server-Sent Events) 관련 구현
┃ ┃ ├── 📜eventHub.ts            # 이벤트 허브
┃ ┃ └── 📜sseEmitters.ts         # SSE 이벤트 에미터
┃ ┣ 📂dtos                       # 데이터 전송 객체 (DTO) 정의
┃ ┣ 📂integration-test           # 통합 테스트
┃ ┃ ├── 📜auth.test.ts           # 인증 통합 테스트
┃ ┃ ├── 📜driver.test.ts         # 기사 통합 테스트
┃ ┃ ├── 📜driverPrivate.test.ts  # 기사 인증 통합 테스트
┃ ┃ ├── 📜estimateReq.test.ts    # 견적 요청 통합 테스트
┃ ┃ ├── 📜customerEstimate.test.ts # 고객 견적 통합 테스트
┃ ┃ ├── 📜favorite.test.ts       # 즐겨찾기 통합 테스트
┃ ┃ └── 📜notification.test.ts   # 알림 통합 테스트
┃ ├── 📜app.ts                   # Express 앱 초기화
┃ ├── 📜instrument.ts            # APM, 모니터링/트레이싱 관련 설정
┃ ├── 📜server.ts                # 서버 실행 엔트리포인트
┃ └── 📜openapi.yaml             # OpenAPI 스펙
┣ 📜.env                         # 환경 변수 설정
┣ 📜.gitignore                   # Git 무시 파일 목록
┣ 📜.http                        # VSCode용 REST Client 요청 모음
┣ 📜.prettierrc                  # Prettier 코드 스타일 설정
┣ 📜jest.config.js               # Jest 테스트 설정
┣ 📜jest.setup.js                # Jest 환경 세팅
┣ 📜openapi.yaml                 # OpenAPI 스펙 문서
┣ 📜package-lock.json            # npm 패키지 잠금 파일
┣ 📜package.json                 # 프로젝트 의존성 및 스크립트
┣ 📜tsconfig.json                # TypeScript 설정
┣ 📜erd.png                      # 데이터베이스 ERD 다이어그램
┗ 📜README.md                    # 프로젝트 설명 문서
```

</div>
</details>
